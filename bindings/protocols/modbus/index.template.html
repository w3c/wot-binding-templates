<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <script src='https://www.w3.org/Tools/respec/respec-w3c' class='remove'></script>
    <script class='remove'>
        var respecConfig = {
            specStatus: "ED",
            group: "wg/wot",
            editors: [
                { 
                    name: "Cristiano Aguzzi", 
                    w3cid: "105495", 
                    company: "Invited Expert", 
                    companyURL: "https://github.com/relu91" 
                }
            ],
            edDraftURI: "https://w3c.github.io/wot-binding-templates/bindings/protocols/modbus/",
            shortName: "wot-modbus-binding",
            github: "https://github.com/w3c/wot-binding-templates",
            otherLinks: [
              {
                key: "Core Binding Templates Specification",
                data: [
                    {
                    value: "Web of Things (WoT) Binding Templates",
                    href: "../../../index.html"
                    }
                ]
              },
              {
                  key: "Ontology",
                  data: [
                      {
                      value: "Modbus in RDF",
                      href: "ontology.html"
                      }
                  ]
              },
              {
                  key: "JSON Schema",
                  data: [
                      {
                      value: "Modbus JSON Schema",
                      href: "modbus.schema.json"
                      }
                  ]
              }
            ]
        };
    </script>
    <title>Web of Things (WoT) Modbus Binding Template</title>
</head>

<body>
    <section id='abstract'>
        <p>
            In the context of the Web of Things (WoT), a Binding Template is a blueprint that gives guidance on how to 
            implement a specific IoT protocol, data format or IoT platform.
            The Core Binding Templates specification explains the overall mechanism and requirements for any binding to follow.
            This document gives implementation guidelines regarding the Modbus protocol, which is a well-known 
            cost-effective IoT protocol for communication between industrial control and automation devices. 
        </p>
        <p>
            More specifically, this document defines a set of vocabulary terms that can be used inside a Thing Description document, 
            and associated rules which allow to describe WoT operations using the Modbus protocol over the network.
            Additionally, relevant examples are provided to showcase different vocabulary terms and the associated behavior. 
        </p>
    </section>
    <section id='introduction'>
        <h2>Introduction</h2>
        <p>
            The Modbus is a data communication protocol originally developed by Modicon which is now a part of Schneider Electric.
            The protocol was specifically designed for the remote management of the hardware devices in the industrial environment.
            For this reason, it has low level of abstraction and it has built in bit handling capabilities oriented to the direct
            control of the relays and generic contact statuses.
            The physical layer it is mainly an RS485 differential bus which has less susceptibility to the EMC interference. This Limit
            the usability of the protocol in short distance networks, typically within a kilometer. 
            Due to its age the protocol does not implement any safety system, so usually when wide internet access is needed it is
            encapsulated in a TCP/IP protocol and with Ethernet as a physical layer. Thanks to this encapsulation strategy, the Modbus protocol
            can reach remote nodes deployed in distant facilities over the internet. Moreover, in the years due to its simplicity and cost-effectiveness 
            the Modbus protocol becomes a standard all over the world. This fame together with the advancement of the microcontroller/microprocessor led to 
            a shift on how applications pack the information. Today it is usual to store and read any type of data in the Holdings Registers like bit, bytes, words, float etc.
        </p>
        <p>
            This document describes how the Web of Things specification can be use to present devices that use the Modbus protocol in a <a href="https://w3c.github.io/wot-architecture/#sec-thing-description">Thing Description</a>. 
            In particular, the document explain how to create valid URLs and Forms for the different operations that the Modbus protocol can perform. 
            Developers are encouraged to use this document as an implementation guidelines and as a reference for the creation of their own binding implementations. 
            The following sections will cover the URL format, the Vocabulary and a list of Form examples. 
        </p>
    </section>
    <section id='sotd'>
        <p>
            <em>This document is a work in progress</em>
        </p>
    </section>
    <section id="url">
        <h2>URL format</h2>
        Historically different URL scheme has been used inside the Modbus community: <code>modbus+tpc://</code>, <code>modbus+ascii://</code> and <code>modbus+rtu://</code>.
        Considering that in Web of Things context all protocol binding templates are required to at least support the Internet Protocol, for the Modbus protocol <code>modbus+tcp://</code> 
        was selected as the only valid URL scheme. The following shows the typical structure of an URL of the Modbus protocol:
        <pre>
            modbus+tcp://{address}:{port}/{unitID}/{address}?quantity={?quantity}
        </pre>

        <p>
            Where:
            <ul>
                <li><code>{address}</code> is the IP address of the Modbus device</li>
                <li><code>{port}</code> is the port of the Modbus device</li>
                <li><code>{unitID}</code> is the unit ID of the Modbus device. See <a href="#vocabulary">vocabulary</a></li>
                <li><code>{address}</code> is the address of the register/coil referenced in this URL. See <a href="#vocabulary">vocabulary</a></li>
                <li><code>{quantity}</code> the amount of registers/coils referenced in this URL. See <a href="#vocabulary">vocabulary</a></li>
            </ul>
            For the full syntax see [[[#abnf]]]
        </p>
    </section>
    <section id="vocabulary">
        <h2>Modbus Vocabulary</h2>
        This section describes the vocabulary used in the Modbus protocol. 
        A protocol binding template implementation should use the vocabulary defined in this section to
        describe the different configuration that can be used to exchanged data between Web of Things.
        <section>
            <h3>URL terms</h3>
            <table class="def">
                <thead>
                    <tr>
                        <th>Vocabulary term</th>
                        <th>Description</th>
                        <th>Assignment</th>
                        <th>Type</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Generate forms terms from the ontology-->
                    %s
                </tbody>
            </table>
        </section>
        <section>
            <h3>Form terms</h3>
            <table class="def">
                <thead>
                    <tr>
                        <th>Vocabulary term</th>
                        <th>Description</th>
                        <th>Assignment</th>
                        <th>Type</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Generate forms terms from the ontology-->
                    %s
                </tbody>
            </table>
        </section>
        <section id="entity">
            <h3>Entity</h3>
            A more user-friendly property to specify [[[#function]]]. The client will then determine the right function code to be applied in
            the modbus request. Futhermore, it can be used in multi-operation forms whereas <code>modbus:function</code> cannot (See the
            [[[#example-read-coil-entity]]])
            
            <table class="def" title="Entity values">
                <thead>
                    <tr>
                        <th>Value</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Generate possible values of the entity class-->
                    %s
                </tbody>
            </table>
            <b>Notice</b> that when used in conjunction with <code>modbus:function</code>, the value of <code>modbus:function</code> property should be ignored.
        </section>
        <section id="function">
            <h3>Function</h3>
            Function Code class represent the value of the function field in a Modbus frame. The 
            following table list the supported codes and their description:
            <table class="def" title="Function values">
                <thead>
                    <tr>
                        <th>Value</th>
                        <th>Label</th>
                        <th>Code</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Generate possible values of the function codes-->
                    %s
                </tbody>
            </table>
        </section>
    </section>
    <section id="mappings">
        <h2>Mappings</h2>
        <p>This section describes strategies and default values to employ protocol specific concepts within the <a href="https://w3c.github.io/wot-architecture/#dfn-interaction-model">WoT Interaction
        model</a>. </p>
        <section id="default-mappings">
            <h3>Default mappings</h3>
            <p>
                The following table lists the default mappings between the protocol specific concepts and the WoT concepts. Please note that operations that are not
                listed in the table are not supported by this binding template. For example, since the Modbus protocol is a request-response based protocol, the
                <code>subscribeevent</code> operation is not supported.
            <table class="def">
                <thead>
                    <tr>
                        <th>Operation</th>
                        <th>Default Binding</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Generate mappings from the mapping ontology -->
                    %s
                </tbody>
            </table>
            The next table defines default values for other terms, regardless of their use in combination with one of the operations listed in the table above.
            <table class="def">
                <thead>
                    <tr>
                        <th>Operation</th>
                        <th>Default</th>
                        <th>Comments</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>modbus:quantity</code></td>
                        <td>
                            <code>1</code>
                        </td>
                        <td></td>
                    </tr>
                    <tr>
                        <td><code>modbus:zeroBaseAddressing</code></td>
                        <td>
                            <code>false</code>
                        </td>
                        <td></td>
                    </tr>
                    <tr>
                        <td><code>modbus:timeout</code></td>
                        <td>
                            <code>infinite</code>
                        </td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
        </section>
        <section id="possible-mappings">
            <h3>Possible mappings</h3>
            <p>
                Additional to the default mappings, users may decide to use other [[[#function]]]s for a specific operation. The following table
                lists examples of possible mappings for some operation types.
            </p>
            <table class="def">
                <thead>
                    <tr>
                        <th>Operation</th>
                        <th>Possible Binding</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>writeproperty</code></td>
                        <td>
                            <code>"modbus:function":"writeMultipleCoils"</code>
                        </td>
                    </tr>
                    <tr>
                        <td><code>writeproperty</code></td>
                        <td>
                            <code>"modbus:function":"writeSingleHoldingRegister"</code>
                        </td>
                    </tr>
                    <tr>
                        <td><code>readproperty</code></td>
                        <td>
                            <code>"modbus:function":"readDeviceIdentification"</code>
                        </td>
                    </tr>
                    <tr>
                        <td><code>readproperty</code></td>
                        <td>
                            <code>"modbus:function":"readDiscreteInput"</code>
                        </td>
                    </tr>
                    <tr>
                        <td><code>observeproperty</code></td>
                        <td>
                            <code>"modbus:function":"readCoil"</code>;
                            <code>"modbus:pollingTime": 1000</code>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>
    </section>
    <section>
        <h2>Examples</h2>
        This section will present a set of examples about how the terms defined in this document can be used
        to describe and configure a <a>Form</a>. The [[[#example-read-coil]]] shows the minimal set of terms 
        to configure a single coil reading using Modbus. Notice that the unitID is contained in the href as the 
        first element of the path. 
        <pre id="example-read-coil" class="example" title="Read a single coil">
            {
                "href": "modbus+tcp://127.0.0.1:60000/1",
                "op": [
                    "readproperty"
                ],
                "modbus:function": "readCoil",
                "modbus:address": 1
            }
        </pre>
        To describe forms with multiple operations types, the [[[#entity]]] keyword can be used to create 
        a short description of the modbus endpoint.
        <pre id="example-read-coil-entity" class="example" title="Read and write single coil">
                    {
                        "href": "modbus+tcp://127.0.0.1:60000/1/1",
                        "op": [
                            "readproperty",
                            "writeproperty"
                        ],
                        "modbus:entity": "Coil",
                    }
        </pre>
        A TD processor will intepred [[[#example-read-coil-entity]]] configuration as the following:
        <pre id="example-read-coil-entity" class="example" title="Read and write single coil expanded">
                            {
                                "href": "modbus+tcp://127.0.0.1:60000/1/1",
                                "op": [
                                    "readproperty",
                                ],
                                "modbus:function": "readCoil",
                            },
                            {
                                "href": "modbus+tcp://127.0.0.1:60000/1/1",
                                "op": [
                                    "writeproperty",
                                ],
                                "modbus:function": "writeCoil",
                            },
        </pre>
        Reducing effectively the verbosity of a TD. 

        Thanks to the expressiveness of the Modbus ontology users can describe also the total 
        number of registries read or wrote in a WoT operation. [[[#example-read-holding]]] shows how to read or write 
        8 HoldingRegisters. 
        <pre id="example-read-holding" class="example" title="Read 8 holding registers">
                            {
                                "href": "modbus+tcp://127.0.0.1:60000/1/40001?quantity=8",
                                "op": [
                                    "readproperty",
                                    "writeproperty"
                                ],
                                "modbus:entity": "HoldingRegister"
                            }
                </pre>
        When possible WoT consumers will use Modbus features to read the desired amount of data with a single
        protocol request. However, it may be possible to still specify a total length for Modbus operations
        that do not support reading or writing on a range of registers (see [[[#example-read-coil-range]]]). 
        In these circumstances consumers will perform different requests to satisfy the configuration requirements. 
        <pre id="example-read-coil-range" class="example" title="Read and write 8 single coils with one form">
                            {
                                "href": "modbus+tcp://127.0.0.1:60000/1/1?quantity=8",
                                "op": [
                                    "readproperty",
                                    "writeproperty"
                                ],
                                "modbus:entity": "Coil"
                            }
                </pre>
        Another notable configuration of a form using the Modbus vocabulary is the polling mechanism. Thanks
        to the keyword <code>pollingTime</code> the user can indicate the intervals for observing a particular
        set of registers. Supposing that the device knows that the value of coil register 1 does change every 
        1000 ms, in [[[#example-polling]]], it suggest that the polling time should not be faster than 10 ms. WoT 
        consumers may still create requests faster than the specified time but it should be taken as a reasonable
        default for observing a property. 
        <pre  id="example-polling" class="example" title="Polling">
            {
                "href": "modbus+tcp://127.0.0.1:60000/1/1",
                "op": [
                    "observeproperty"
                ],
                "modbus:entity": "Coil",
                "modbus:pollingTime": 1000,
            }
        </pre>
        Finally, [[[#full-td]]] shows a complete device described using Modbus ontology.
        <pre id="full-td" class="example" title="A complete TD example">
                {
                  "@context": [
                      "https://www.w3.org/2019/wot/td/v1",
                      {
                          "modbus": "https://www.example.com/ns/modbustcp"
                      }
                  ],
                  "title": "ModbusPLC",
                  "description": "An industrial machine, retrofitted to be IoT capable.",
                  "id": "uri:dev:ModbusTCPThing",
                  "securityDefinitions": {
                      "nosec_sc": {
                          "scheme": "nosec"
                      }
                  },
                  "security": "nosec_sc",
              
                  "base": "modbus+tcp://192.168.178.32:502/1/",
                  "properties": {
                      "limitSwitch1": {
                          "title": "downLimitSwitch",
                          "type": "boolean",
                          "description": "Limit switch moving downwards",
                          "forms": [
                              {
                                  "op": "readproperty",
                                  "href": "10003",
                                  "modbus:function": "readDiscreteInput",
                                  "contentType": "application/octet-stream"
                              }
                          ]
                      },
                      "limitSwitch2": {
                          "title": "forwardLimitSwitch",
                          "type": "boolean",
                          "description": "Limit Switch moving forward",
                          "forms": [
                              {
                                  "op": "readproperty",
                                  "href": "10002",
                                  "modbus:function": "readDiscreteInput",
                                  "contentType": "application/octet-stream"
                              }
                          ]
                      },
                      "moveDown": {
                          "title": "moveDown",
                          "type": "boolean",
                          "description": "Down Motor Status (single coil). PLC output, can be written to control the motor.",
                          "forms": [
                              {
                                  "op": [
                                      "writeproperty",
                                      "observeproperty",
                                      "readproperty"
                                  ],
                                  "href": "6",
                                  "modbus:entity": "Coil",
                                  "modbus:pollingTime": 100,
                                  "contentType": "application/octet-stream"
                              }
                          ]
                      },
                      "moveForward": {
                          "title": "moveForward",
                          "type": "boolean",
                          "description": "Forward Motor Status (single coil). PLC output, can be written to control the motor.",
                          "forms": [
                              {
                                   "op": [
                                      "writeproperty",
                                      "observeproperty",
                                      "readproperty"
                                  ],
                                  "href": "3",
                                  "modbus:entity": "Coil",
                                  "modbus:pollingRate": 100,
                                  "contentType": "application/octet-stream"
                              }
                          ]
                      }
                  }
              }
              </pre>
    </section>
    <section class="appendix" id="abnf">
        <h2>Modbus URL ABNF syntax</h2>
        <p>The following describe the [[[#url]]] using [[[RFC2234]]] with the reference to [[[uri]]] specification. </p>
        <pre class="syntax">
            MODBUS-URI = "modbus+tcp://" authority path-modbus [ "?quantity=" quantity ]
            path-modbus = "/" unitID "/" address
            unitID=1*DIGIT
            address=1*DIGIT
            quantity=1*DIGIT
        </pre>
    </section>
</body>

</html>